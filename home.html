<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Entre Alunos - Portal Estudantil</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --sidebar:#2c54a3;
      --accent:#080808;
      --panel:#ffffff;
      --muted:#000000;
    }

    body{
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#25478a 0%, #17305e 100%);
    }

    header{height:64px}
    aside{width:260px;min-width:260px;background:var(--sidebar);}

    /* calendario boxes */
    #calendarioGrid > div{
      min-height:86px;
      padding:12px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      transition:transform .12s ease, box-shadow .12s ease, background-color .12s ease;
      cursor:pointer;
      position:relative;
    }
    #calendarioGrid > div:hover{ transform: translateY(-6px); box-shadow: 0 12px 30px rgb(14, 35, 128); }
    .dia-num{ font-weight:700; color:#1d2c4e; }
    .dia-evento-badge{ background:#bbf7d0; color:#065f46; padding:4px 8px; border-radius:999px; font-size:12px; display:inline-block }
    .hoje{ border:3px solid #0ea5e9; }

    /* tooltip */
    .tooltiptext{ visibility:hidden; position:absolute; top:10px; right:10px; background:rgb(30, 67, 235); color:#ffffff; padding:8px; border-radius:8px; font-size:12px; z-index:40; box-shadow:0 8px 24px rgba(2,6,23,0.3); max-width:240px; text-align:left;}
    .tooltip:hover .tooltiptext{ visibility:visible; }

    /* scrollbar forum */
    #listaForum::-webkit-scrollbar{ width:8px }
    #listaForum::-webkit-scrollbar-thumb{ background:rgb(21, 45, 152); border-radius:6px }

    /* responsive: hide sidebar under 920 */
    @media (max-width:920px){ aside{display:none;} main{padding:16px;} }

    /* --- Sidebar submenu estilo "Twitter" --- */
    .sidebar-btn { width:100%; display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:8px; }
    .sidebar-btn:hover{ background:rgba(255,255,255,0.06); cursor:pointer; }
    .sidebar-btn.active{ background:rgba(255,255,255,0.08); }
    .submenu { margin-left:34px; margin-top:6px; display:none; flex-direction:column; gap:6px; }
    .submenu .subitem { padding:8px 12px; border-radius:8px; font-size:14px; text-align:left; }
    .submenu .subitem:hover{ background:rgba(0,0,0,0.05); cursor:pointer; }
    .sidebar .subitem.active { background:rgba(0,0,0,0.08); font-weight:600; }

    /* small visual tweak so iframe fills nice area */
    .fill-iframe { width:100%; height:100%; border:0; }

    .avatar-opcao{
  width: 56px;
  height: 56px;
  border-radius: 999px;
  object-fit: cover;
  cursor: pointer;
  border: 2px solid transparent;
  transition: transform .2s, border .2s;

  box-shadow: 0 2px 6px rgba(0,0,0,0.2);

}

.avatar-opcao:hover{
  transform: scale(1.08);
  border-color: #2563eb;

}

html, body {
  overflow: hidden;
}

html, body {
  height: 100%;
  overflow: hidden;
  margin: 0;
}

#app, .app, #dashboard {
  height: 100vh;
  overflow: hidden;
}

main, .conteudo, .content {
  height: calc(100vh - 80px); /* desconta o header */
  overflow: hidden;
}

main, .conteudo, .content {
  margin-top: 0 !important;
  padding-top: 10px !important;
  align-items: flex-start;
}

#dashboard, .app {
  align-items: flex-start;
}

main {
  position: relative;
  top: -20px;
}

html, body {
  overflow: hidden !important;
}

#jogos, .jogos-container, .area-jogo {
  overflow: hidden !important;
  height: 100%;
}

.area-jogo * {
  max-height: 90vh;
  max-width: 90vw;
  box-sizing: border-box;
}

html, body {
  overflow: hidden !important;
}


  </style>
</head>

<body class="min-h-screen text-slate-100">

  <script>
    // redireciona para login se n√£o estiver logado (mantive comportamento original)
    let role = localStorage.getItem('role');
    if(!role){ /* n√£o redireciono automaticamente para facilitar testes locais; se quiser ativar, descomente abaixo */
      // location.href = 'login.html';
    }
  </script>

  <!-- HEADER -->
  <header class="sticky top-0 z-40 bg-[rgba(255,255,255,0.04)] backdrop-blur border-b border-white/5">
    <div class="max-w-[1400px] mx-auto px-6 flex items-center h-16 gap-4">
      <div class="flex items-center gap-4">
        <div class="w-10 h-10 bg-white rounded-md flex items-center justify-center text-slate-900 font-bold shadow">EA</div>
        <div class="text-white text-lg font-semibold">Entre Alunos</div>
      </div>

      <!-- perfil √† direita -->
      <div class="ml-auto flex items-center gap-4">
        <div class="text-sm text-slate-300">Bem-vindo(a)</div>
        <div id="tipoUsuarioTopo"
  class="px-3 py-1 rounded-full text-xs font-bold text-white bg-gray-500">
  Carregando...
</div>

        <div id="perfilWrapper" class="relative">
          <button id="perfilToggle" class="flex items-center gap-2 bg-white/6 hover:bg-white/10 text-white px-3 py-1 rounded">
            <img id="perfilFoto" src="https://via.placeholder.com/32" alt="Perfil" class="w-8 h-8 rounded-full object-cover border-2 border-white/50"/>
            <span id="perfilNomeHeader" class="text-sm">Usu√°rio</span>
          </button>

         <div id="perfilDropdown" class="hidden absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-xl text-slate-800 p-4 z-50">

  <div class="flex items-center gap-3 border-b pb-3">
    <img id="perfilFotoDropdown" src="https://via.placeholder.com/48"
      class="w-12 h-12 rounded-full border object-cover">

    <div>
      <div id="perfilNome" class="font-semibold"></div>
      <div id="perfilTipo" class="text-xs text-slate-500"></div>
    </div>
  </div>

  <div class="mt-3 text-sm space-y-1">
    <div>üìß <span id="perfilEmail">email@escola.com</span></div>
    <div>üéì Curso: <span id="perfilCurso">Inform√°tica</span></div>
    <div>üè´ Turma: <span id="perfilTurma">2¬∫ Ano</span></div>
  </div>

  <div class="grid grid-cols-3 gap-2 text-center text-xs mt-4">
    <div class="bg-slate-100 p-2 rounded">
      <strong id="perfilVotos">0</strong>
      <div>Votos</div>
    </div>
    <div class="bg-slate-100 p-2 rounded">
      <strong id="perfilPosts">0</strong>
      <div>Posts</div>
    </div>
    <div class="bg-slate-100 p-2 rounded">
      <strong id="perfilJogos">0</strong>
      <div>Jogos</div>
    </div>
  </div>

  <div class="flex gap-2 mt-4">
  <button onclick="abrirEditarPerfil()"
    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-sm">
    Editar
  </button>

  <button onclick="abrirModalAvatar()"
    class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 rounded text-sm">
    Trocar Foto
  </button>

  <button onclick="logout()"
    class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 rounded text-sm">
    Sair
  </button>
</div>


</div>

        </div>
      </div>

    </div>
  </header>

  <div class="max-w-[1400px] mx-auto flex gap-6 px-6 py-6">
    <!-- SIDEBAR -->
    <aside class="flex flex-col p-6 rounded-xl shadow-lg text-white sidebar">
      <nav class="flex flex-col gap-2">
        <div id="btnAvisos" class="sidebar-btn" onclick="handleSidebarClick('avisos')">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
          <span class="font-medium">Mural de Avisos</span>
        </div>

        <div id="btnForum" class="sidebar-btn" onclick="handleSidebarClick('forum')">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M21 12v5a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
          <span class="font-medium">F√≥rum</span>
        </div>

        <div id="btnCalendario" class="sidebar-btn" onclick="handleSidebarClick('calendario')">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M3 11h18M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          <span class="font-medium">Calend√°rio</span>
        </div>

        <!-- CHAPAS com submenu estilo moderno -->
        <div id="btnChapas" class="sidebar-btn" onclick="toggleChapasMenu()">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M5 7v10a2 2 0 002 2h10a2 2 0 002-2V7M9 7v10M15 7v10"/></svg>
          <span class="font-medium">Chapas</span>
        </div>

        <div id="chapasSubmenu" class="submenu">
          <div id="subPropostas" class="subitem" onclick="handleSidebarClick('chapas')">Propostas das Chapas</div>
          <div id="subVotacao" class="subitem" onclick="handleSidebarClick('votacao')">üó≥Ô∏è Vota√ß√£o</div>
        </div>

        <div id="btnJogos" class="sidebar-btn" onclick="handleSidebarClick('jogos')">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 9.75L5.25 6v12l4.5-3.75M14.25 9.75L18.75 6v12l-4.5-3.75"/></svg>
          <span class="font-medium">Jogos</span>
        </div>
      </nav>

      <div class="mt-auto">
        <button onclick="logout()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded">Sair</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="flex-1 overflow-hidden">

      <!-- AVISOS -->
      <section id="avisos" class="hidden h-full flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-white">Mural de Avisos</h2>
        </div>

        <div class="flex gap-6 h-full">
          <div class="flex-1 bg-[var(--panel)] rounded-xl p-5 shadow h-[calc(100vh-64px-48px)] overflow-hidden flex flex-col">
            <div id="formAviso" class="mb-4 hidden">
              <div class="flex gap-3">
                <input id="textoAviso" type="text" placeholder="Escreva um aviso..." class="flex-1 border rounded px-3 py-2 focus:outline-none text-slate-900"/>
                <button id="btnAddAviso" class="bg-[var(--accent)] text-white px-4 py-2 rounded">Adicionar</button>
              </div>
            </div>

            <div id="listaAvisos" class="space-y-3 overflow-y-auto pr-2">
              <!-- avisos -->
            </div>
          </div>
        </div>
      </section>

      <!-- FORUM -->
      <section id="forum" class="hidden h-full flex flex-col">
        <div class="mb-4">
          <h2 class="text-lg font-semibold text-white">F√≥rum</h2>
        </div>

        <div class="bg-[var(--panel)] rounded-xl p-5 shadow h-[calc(100vh-64px-48px)] flex flex-col">
          <div id="listaForum" class="flex-1 overflow-y-auto space-y-4 pb-4">
            <!-- posts -->
          </div>

          <form id="formForum" class="mt-4 flex gap-3 items-center">
            <input id="textoForum" type="text" placeholder="Escreva algo para o f√≥rum..." class="flex-1 border rounded-l px-4 py-3 focus:outline-none text-slate-900"/>
            <button class="bg-green-600 text-white px-4 py-3 rounded-r" type="submit">Enviar</button>
          </form>
        </div>
      </section>




      
      <!-- CALEND√ÅRIO -->
      <section id="calendario" class="hidden h-full flex flex-col">
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-white">Calend√°rio</h2>
          <div class="flex items-center gap-3">
            <button onclick="mudarMes(-1)" class="bg-white/6 text-white px-3 py-1 rounded hover:bg-white/10">‚óÄ</button>
            <div id="mesAtual" class="text-white font-medium"></div>
            <button onclick="mudarMes(1)" class="bg-white/6 text-white px-3 py-1 rounded hover:bg-white/10">‚ñ∂</button>
          </div>
        </div>

        <div class="bg-[var(--panel)] rounded-xl p-5 shadow flex flex-col gap-4 h-[calc(100vh-64px-48px)]">
          <div class="grid grid-cols-7 gap-2 text-sm font-medium text-slate-600">
            <div class="text-center">Dom</div><div class="text-center">Seg</div><div class="text-center">Ter</div><div class="text-center">Qua</div>
            <div class="text-center">Qui</div><div class="text-center">Sex</div><div class="text-center">S√°b</div>
          </div>

          <div id="calendarioGrid" class="grid grid-cols-7 gap-4 flex-1 overflow-y-auto"></div>

          <form id="formEvento" class="hidden flex gap-2 items-center">
            <input id="dataEvento" type="date" class="border rounded px-3 py-2 text-slate-900"/>
            <input id="descEvento" type="text" placeholder="Descri√ß√£o do evento" class="flex-1 border rounded px-3 py-2 text-slate-900"/>
            <button class="bg-[var(--accent)] text-white px-4 py-2 rounded">Adicionar</button>
          </form>

          <div>
            <ul id="listaEventos" class="space-y-2 max-h-40 overflow-y-auto"></ul>
          </div>
        </div>
      </section>

      <!-- CHAPAS (com submenu "Propostas") -->
      <section id="chapas" class="hidden h-full flex flex-col">
        <div class="mb-4">
          <h2 class="text-lg font-semibold text-white">Chapas e Propostas</h2>
        </div>

        <div class="bg-[var(--panel)] rounded-xl p-5 shadow h-[calc(100vh-64px-48px)] overflow-auto">
          <form id="formChapa" class="hidden flex flex-col gap-3 mb-4">
            <input id="nomeChapa" type="text" placeholder="Nome da chapa" class="border rounded px-3 py-2 text-slate-900"/>
            <textarea id="propostaChapa" placeholder="Proposta da chapa" class="border rounded px-3 py-2 h-28 resize-none text-slate-900"></textarea>
            <input id="integrantesChapa" type="text" placeholder="Integrantes (separados por v√≠rgula)" class="border rounded px-3 py-2 text-slate-900"/>
            <input id="imagemChapa" type="file" accept="image/*"/>
            <div>
              <button class="bg-[var(--accent)] text-white px-4 py-2 rounded">Adicionar Chapa</button>
            </div>
          </form>

          <ul id="listaChapas" class="space-y-3"></ul>
        </div>
      </section>

      <!-- VOTA√á√ÉO -->
      <section id="votacao" class="hidden h-full flex flex-col">
        <div class="mb-4">
          <h2 class="text-lg font-semibold text-white">Vota√ß√£o Gr√™mio Estudantil</h2>
        </div>

        <div class="bg-[var(--panel)] rounded-xl p-5 shadow h-[calc(100vh-64px-48px)] overflow-auto">
          <iframe src="votacao.html" class="w-full h-full border-0 fill-iframe" frameborder="0"></iframe>
        </div>
      </section>

      <!-- JOGOS -->
      <section id="jogos" class="hidden h-full flex flex-col">
        <div class="mb-4">
          <h2 class="text-lg font-semibold text-white">Jogos</h2>
        </div>

        <div class="bg-[var(--panel)] rounded-xl p-5 shadow h-[calc(100vh-64px-48px)] flex flex-col gap-4">
          <div class="flex gap-3">
            <button onclick="abrirJogo('jogomemoria.html')" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800">
  Jogo da Mem√≥ria
</button>

<button onclick="abrirJogo('jogosimon.html')" class="bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700">
  Jogo do Simon
</button>

          </div>

          <div id="gameContainer" class="flex-1 border rounded overflow-hidden bg-white">
            <div class="w-full h-full flex items-center justify-center text-slate-500">Escolha um jogo para iniciar.</div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Modal evento -->
  <div id="modalEvento" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md mx-auto shadow-lg">
      <h3 class="font-semibold mb-2">Detalhes do Evento</h3>
      <p id="detalhesEvento" class="text-sm text-slate-600 mb-4"></p>
      <div class="text-right">
        <button class="px-4 py-2 rounded bg-slate-200 text-slate-900" onclick="fecharModal()">Fechar</button>
      </div>
    </div>
  </div>

<script>
/* ---------- permiss√µes (role salvo em login.html) ---------- */
let roleLocal = localStorage.getItem('role') || '';
const nomeUsuario = localStorage.getItem('nomeUsuario') || 'Usu√°rio';
const fotoSalva = localStorage.getItem('fotoPerfil');

/* preencher cabe√ßalho e dropdown */
const perfilNomeHeaderEl = document.getElementById('perfilNomeHeader');
const perfilFotoEl = document.getElementById('perfilFoto');
const perfilFotoDropdownEl = document.getElementById('perfilFotoDropdown');
const perfilNomeEl = document.getElementById('perfilNome');
const perfilTipoEl = document.getElementById('perfilTipo');

const perfilEmailEl = document.getElementById('perfilEmail');
const perfilCursoEl = document.getElementById('perfilCurso');
const perfilTurmaEl = document.getElementById('perfilTurma');

const perfilVotosEl = document.getElementById('perfilVotos');
const perfilPostsEl = document.getElementById('perfilPosts');
const perfilJogosEl = document.getElementById('perfilJogos');

const emailUsuario = localStorage.getItem('emailUsuario') || 'email@escola.com';
const cursoUsuario = localStorage.getItem('cursoUsuario') || 'Inform√°tica';
const turmaUsuario = localStorage.getItem('turmaUsuario') || '2¬∫ Ano';

if(perfilNomeHeaderEl) perfilNomeHeaderEl.textContent = nomeUsuario;

if(perfilFotoEl && fotoSalva) perfilFotoEl.src = fotoSalva;
if(perfilFotoDropdownEl && fotoSalva) perfilFotoDropdownEl.src = fotoSalva;

if(perfilNomeEl) perfilNomeEl.textContent = nomeUsuario;
if(perfilTipoEl) perfilTipoEl.textContent =
  roleLocal ? (roleLocal.charAt(0).toUpperCase() + roleLocal.slice(1)) : '';

if(perfilEmailEl) perfilEmailEl.textContent = emailUsuario;
if(perfilCursoEl) perfilCursoEl.textContent = cursoUsuario;
if(perfilTurmaEl) perfilTurmaEl.textContent = turmaUsuario;

// estat√≠sticas autom√°ticas
if(perfilVotosEl) perfilVotosEl.textContent = localStorage.getItem('totalVotos') || 0;
if(perfilJogosEl) perfilJogosEl.textContent = localStorage.getItem('jogosAbertos') || 0;


/* toggle do dropdown */
const perfilToggleBtn = document.getElementById('perfilToggle');
const perfilDropdown = document.getElementById('perfilDropdown');
const perfilWrapper = document.getElementById('perfilWrapper');
if(perfilToggleBtn){
  perfilToggleBtn.addEventListener('click', function(e){
    e.stopPropagation();
    if(perfilDropdown) perfilDropdown.classList.toggle('hidden');
  });
}
window.addEventListener('click', function(e){
  if(!e.target.closest('#perfilWrapper')){
    if(perfilDropdown) perfilDropdown.classList.add('hidden');
  }
});

/* storage helpers */
const storage = {
  avisos: ()=> JSON.parse(localStorage.getItem('avisos')||'[]'),
  saveAvisos: arr => localStorage.setItem('avisos', JSON.stringify(arr)),
  forum: ()=> JSON.parse(localStorage.getItem('forum')||'[]'),
  saveForum: arr => localStorage.setItem('forum', JSON.stringify(arr)),
  eventos: ()=> JSON.parse(localStorage.getItem('eventos')||'[]'),
  saveEventos: arr => localStorage.setItem('eventos', JSON.stringify(arr)),
  chapas: ()=> JSON.parse(localStorage.getItem('chapas')||'[]'),
  saveChapas: arr => localStorage.setItem('chapas', JSON.stringify(arr)),
};
if(perfilPostsEl) perfilPostsEl.textContent = storage.forum().length;

/* navigation */
function mostrarTela(tela){
  document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
  const sec = document.getElementById(tela);
  if(sec) sec.classList.remove('hidden');

  document.querySelectorAll(".sidebar-btn").forEach(b => b.classList.remove('active'));
  document.querySelectorAll(".subitem").forEach(b => b.classList.remove('active'));

  if(tela === "chapas"){
    document.getElementById("btnChapas").classList.add("active");
    document.getElementById("subPropostas").classList.add("active");
    abrirChapasSubmenu();
  } else if (tela === "votacao"){
    document.getElementById("btnChapas").classList.add("active");
    document.getElementById("subVotacao").classList.add("active");
    abrirChapasSubmenu();
  } else if (tela === "avisos"){
    document.getElementById("btnAvisos").classList.add("active");
  } else if (tela === "forum"){
    document.getElementById("btnForum").classList.add("active");
  } else if (tela === "calendario"){
    document.getElementById("btnCalendario").classList.add("active");
  } else if (tela === "jogos"){
    document.getElementById("btnJogos").classList.add("active");
  }
}

function logout(){ localStorage.removeItem('role'); window.location.href = 'index.html'; }

/* ---------- SIDEBAR ---------- */
function handleSidebarClick(tela){
  if(tela === "chapas" || tela === "votacao"){
    abrirChapasSubmenu();
  } else {
    fecharChapasSubmenu();
  }
  mostrarTela(tela);
}
function toggleChapasMenu(){
  const menu = document.getElementById("chapasSubmenu");
  const atual = menu.style.display;
  if(atual === "flex"){
    menu.style.display = "none";
  } else {
    menu.style.display = "flex";
  }
}
function abrirChapasSubmenu(){ document.getElementById("chapasSubmenu").style.display = "flex"; }
function fecharChapasSubmenu(){ document.getElementById("chapasSubmenu").style.display = "none"; }

/* ---------- AVISOS ---------- */
function renderAvisos(){
  const container = document.getElementById('listaAvisos');
  container.innerHTML = '';
  const avisos = storage.avisos();

  if(!avisos || avisos.length === 0){
    container.innerHTML = '<div class="text-slate-500">Nenhum aviso ainda.</div>';
  } else {
    avisos.forEach((a, idx) => {
      // suporta tanto strings quanto objetos {texto: '...'}
      const texto = (typeof a === 'string') ? a : (a.texto || '');
      const item = document.createElement('div');
      item.className = 'p-3 rounded border bg-white flex justify-between items-start';
      item.innerHTML = `<div class="text-slate-800 font-medium">${texto}</div><div class="text-sm text-slate-500 mt-1">Publicado</div>`;
      if(roleLocal === 'gestor'){
        const wrap = document.createElement('div'); wrap.className = 'ml-4 flex flex-col gap-2';
        const btnEdit = document.createElement('button'); btnEdit.className='px-3 py-1 bg-yellow-400 rounded text-slate-800 text-sm'; btnEdit.textContent='Editar';
        btnEdit.onclick = ()=>{ const novo = prompt('Editar aviso:', texto); if(novo!==null){ const all = storage.avisos(); all[idx] = (typeof a === 'string') ? novo.trim() : {texto: novo.trim()}; storage.saveAvisos(all); renderAvisos(); } };
        const btnDel = document.createElement('button'); btnDel.className='px-3 py-1 bg-red-500 rounded text-white text-sm'; btnDel.textContent='Apagar';
        btnDel.onclick = ()=>{ if(!confirm('Confirma exclus√£o do aviso?')) return; const all = storage.avisos(); all.splice(idx,1); storage.saveAvisos(all); renderAvisos(); };
        wrap.appendChild(btnEdit); wrap.appendChild(btnDel); item.appendChild(wrap);
      }
      container.appendChild(item);
    });
  }

  // mostra formul√°rio apenas para gestor
  const formEl = document.getElementById('formAviso');
  if(formEl){
    formEl.style.display = (roleLocal === 'gestor') ? 'block' : 'none';
  }
}

document.getElementById('btnAddAviso')?.addEventListener('click', ()=>{
  if(roleLocal !== 'gestor') return alert('Apenas gestores podem adicionar avisos.');
  const input = document.getElementById('textoAviso');
  const texto = input.value.trim();
  if(!texto) return alert('Escreva algo para adicionar.');
  const avisos = storage.avisos();
  avisos.unshift({texto});
  storage.saveAvisos(avisos);
  input.value = '';
  renderAvisos();
});


/* ---------- PALAVRAS PROIBIDAS ---------- */
const palavrasProibidas = [
  "caralho",
"karalho",
"k4r4lh0",
"k4r4lho",
"k4ralho",
"kar4lho",
"karalh0",
"kar4lh0",
"k4ralh0",
"merda",
"m3rd4",
"merd4",
"m3rda",
"buceta",
"bct",
"bucet4",
"pau no cu",
"burro",
"filha da puta",
"fdp",
"safado",
"safada",
"filho da puta",
"puta",
"puto",
"safadinho",
"safadinha",
"periquita",
"priquito",
"prikito",
"priquita",
"prikita",
"perereca",
"xana",
"penis",
"p√™nis",
"pau",
"pinto",
"piroca",
"sexo",
"fuder",
"foda",
"transa",
"transar",
"boquete",
"bqt",
"peito",
"seios",
"seio",
"teta",
"tetas",
"putaria",
"maconha",
"tr√°fico",
"trafico",
"traficar",
"coca√≠na",
"cocaina",
"droga",
"drogas",
"drogado",
"drogada",
"traficante",
"matar",
"assassinar",
"atirar",
"morrer",
"porn√¥",
"porno",
"punheta",
"punhetar",
"siririca",
"cacete",
"kct",
"kacete",
"vadia",
"vadio",
"vagabundo",
"vagabunda",
"piranha",
"fodido",
"quenga",
"filho da mae",
"filha da mae",
"filho da m√£e",
"filha da m√£e",
"toba",
"cu",
"anus",
"an√ªs",
"bunda",
"bundinha",
"nadegas",
"bumbum",
"vagina",
"macaco",
"negrinho",
"viado",
"bicha",
"bixa",
"viadinho",
"traveco",
"viagra",
"tadalafila",
"tes√£o",
"tesao",
"excitado",
"excitar",
"gozar",
"gozo",
"gozei",
"gozado",
"gozada",
"leitada",
"semen",
"sem√™n",
"dedada",
"balofo",
"baseado",
"cigarro",
"pod",
"vape",
"gord√£o",
"gordinho",
"adotado",
"estupro",
"estuprar",
"estuprada",
"estuprado",
"estrupo",
"estrupar",
"estrupado",
"estrupada",
"gostosa",
"gostoso",
"sexy",
"pica",
"pika",
"porra",
"puta que pariu",
"pqp",
"trepar",
"xoxota",
"arrombado",
"babaca",
"brocha",
"boiola",
"cracudo",
"corno",
"corna",
"canalha",
"desgra√ßado",
"desgra√ßada",
"ot√°rio",
"otario",
"imbecil",
"abutre",
"prostata",
"prost√°ta",
"asqueroso",
"bandido",
"trouxa",
"bastardo",
"bichona",
"cag√£o",
"cagao",
"cegueta",
"carni√ßa",
"chifrudo",
"chifruda",
"escroto",
"escrota",
"cagar",
"bosta",
"mijar",
"peido",
"peidar",
"capeta",
"cretino",
"demonio",
"escravo",
"incapaz",
"infeliz",
"ladr√£o",
"ladrao",
"magricela",
"necr√≥filo",
"pintudo",
"pirocudo",
"sapatona",
  
  "xingo",
  "idiota"
];

function contemPalavraProibida(texto){
  const textoMinusculo = texto.toLowerCase();
  return palavrasProibidas.some(palavra =>
    textoMinusculo.includes(palavra.toLowerCase())
  );
}


/* ---------- FORUM ---------- */
function renderForum(){
  const lista = document.getElementById('listaForum'); lista.innerHTML = '';
  const posts = storage.forum();
  if(posts.length === 0) lista.innerHTML = '<div class="text-slate-500">Nenhuma mensagem ainda.</div>';
  posts.forEach((p, idx) => {
    const card = document.createElement('div');
    card.className = 'bg-white rounded p-4 shadow flex justify-between items-start gap-4 text-slate-900';
    card.innerHTML = `<div><div class="text
-slate-800 font-medium">${p.texto || p}</div>
      <div class="text-xs text-slate-500 mt-2">Publicado</div></div>`;

    if(roleLocal === 'gestor'){
      const actions = document.createElement('div'); actions.className='flex gap-2';
      const btnDel = document.createElement('button');
      btnDel.className='px-2 py-1 bg-red-500 text-white rounded text-sm';
      btnDel.textContent='Apagar';
      btnDel.onclick = ()=>{
        if(!confirm('Remover esta mensagem?')) return;
        const postsAll = storage.forum();
        postsAll.splice(idx,1);
        storage.saveForum(postsAll);
        renderForum();
      };
      actions.appendChild(btnDel);
      card.appendChild(actions);
    }
    lista.appendChild(card);
  });
}

document.getElementById('formForum')?.addEventListener('submit', e=>{
  e.preventDefault();

  const texto = document.getElementById('textoForum').value.trim();

  if(!texto) return;

  // ‚úÖ VERIFICA PALAVRAS PROIBIDAS
  if(contemPalavraProibida(texto)){
    alert("Sua mensagem cont√©m palavras proibidas e n√£o pode ser enviada.");
    return;
  }

  const posts = storage.forum();
  posts.push({texto});
  storage.saveForum(posts);

  document.getElementById('textoForum').value = '';
  renderForum();

  setTimeout(()=>{
    const box = document.getElementById('listaForum');
    box.scrollTop = box.scrollHeight;
  },80);
});


/* ---------- CALEND√ÅRIO ---------- */
let hoje = new Date(), mes = hoje.getMonth(), ano = hoje.getFullYear();

function renderCalendario(){
  const grid = document.getElementById('calendarioGrid'); grid.innerHTML='';
  const listaEventos = document.getElementById('listaEventos'); listaEventos.innerHTML='';
  const base = new Date(ano, mes, 1);
  document.getElementById('mesAtual').textContent =
    base.toLocaleString('pt-BR', {month:'long', year:'numeric'});

  const eventos = storage.eventos().filter(ev=>{
    const d = new Date(ev.data+'T00:00:00');
    return d.getMonth()===mes && d.getFullYear()===ano;
  });

  const startDay = base.getDay();
  for(let i=0;i<startDay;i++){
    const empty=document.createElement('div');
    grid.appendChild(empty);
  }

  const daysInMonth = new Date(ano, mes+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const box = document.createElement('div');
    const dataStr = `${ano}-${String(mes+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const evs = eventos.filter(e=>e.data===dataStr);
    const num = document.createElement('div');
    num.className='dia-num'; num.textContent=d; box.appendChild(num);

    if(d===hoje.getDate() && mes===hoje.getMonth() && ano===hoje.getFullYear()){
      box.classList.add('hoje');
    }

    if(evs.length){
      box.classList.add('tooltip');
      const tip = document.createElement('div'); tip.className='tooltiptext';
      tip.innerHTML = evs.map(e => `<div class="font-medium">${e.desc}</div>`).join('');
      box.appendChild(tip);
      const badge = document.createElement('div');
      badge.className='dia-evento-badge mt-2';
      badge.textContent = `${evs.length} evento${evs.length>1?'s':''}`;
      box.appendChild(badge);
    } else {
      box.classList.add('bg-slate-50/80');
    }

    box.onclick = ()=>{ if(evs.length) abrirModal(dataStr); };
    grid.appendChild(box);
  }

  eventos.forEach((ev, idx)=>{
    const li = document.createElement('li');
    li.className = 'p-2 rounded border flex justify-between items-center text-slate-900';
    li.innerHTML = `<div><div class="font-medium">${ev.desc}</div>
      <div class="text-sm text-slate-500">${new Date(ev.data+'T00:00:00').toLocaleDateString('pt-BR')}</div></div>`;

    if(roleLocal==='gestor'){
      const btn = document.createElement('button');
      btn.className='px-2 py-1 bg-red-500 text-white rounded text-sm';
      btn.textContent='Apagar';
      btn.onclick = ()=>{
        if(!confirm('Excluir evento?')) return;
        const allEvents = storage.eventos();
        const remaining = allEvents.filter(e => !(e.data===ev.data && e.desc===ev.desc));
        storage.saveEventos(remaining);
        renderCalendario();
      };
      li.appendChild(btn);
    }
    listaEventos.appendChild(li);
  });

  document.getElementById('formEvento').style.display =
    (roleLocal==='gestor') ? 'flex' : 'none';
}

document.getElementById('formEvento')?.addEventListener('submit', e=>{
  e.preventDefault();
  if(roleLocal!=='gestor') return;
  const data = document.getElementById('dataEvento').value;
  const desc = document.getElementById('descEvento').value.trim();
  if(!data || !desc) return alert('Preencha data e descri√ß√£o.');
  const evs = storage.eventos();
  evs.push({data, desc});
  storage.saveEventos(evs);
  document.getElementById('dataEvento').value='';
  document.getElementById('descEvento').value='';
  renderCalendario();
});

function mudarMes(delta){
  mes += delta;
  if(mes<0){ mes=11; ano--; }
  if(mes>11){ mes=0; ano++; }
  renderCalendario();
}

function abrirModal(dataStr){
  const ev = storage.eventos().find(e=>e.data===dataStr);
  if(!ev) return;
  document.getElementById('detalhesEvento').textContent =
    `${new Date(ev.data+'T00:00:00').toLocaleDateString('pt-BR')}: ${ev.desc}`;
  const modal=document.getElementById('modalEvento');
  modal.classList.remove('hidden'); modal.classList.add('flex');
}
function fecharModal(){
  const modal=document.getElementById('modalEvento');
  modal.classList.add('hidden');
}

/* ---------- CHAPAS ---------- */
function renderChapas(){
  const list = document.getElementById('listaChapas'); list.innerHTML='';
  const chapas = storage.chapas();
  if(chapas.length===0){
    list.innerHTML = '<div class="text-slate-500">Nenhuma chapa cadastrada.</div>';
  }
  chapas.forEach((c, idx)=>{
    const li = document.createElement('li');
    li.className='p-3 rounded border bg-white';
    li.innerHTML = `<div class="font-medium text-lg text-slate-900">${c.nome}</div>
      <div class="text-sm text-slate-600 mt-1">${c.proposta}</div>
      <div class="text-sm italic mt-2 text-slate-500">Integrantes: ${c.integrantes||'-'}</div>`;
    if(c.imagem){
      const img=document.createElement('img');
      img.src=c.imagem; img.className='mt-3 max-h-36 rounded';
      li.appendChild(img);
    }

    if(roleLocal==='gestor'){
      const wrap=document.createElement('div');
      wrap.className='flex gap-2 mt-3';

      const btnEdit=document.createElement('button');
      btnEdit.className='px-3 py-1 bg-yellow-400 rounded text-slate-800';
      btnEdit.textContent='Editar';
      btnEdit.onclick=()=>{
        const novo = prompt('Editar proposta:', c.proposta);
        if(novo!==null){
          const all = storage.chapas();
          all[idx].proposta = novo.trim();
          storage.saveChapas(all);
          renderChapas();
        }
      };

      const btnDel=document.createElement('button');
      btnDel.className='px-3 py-1 bg-red-500 rounded text-white';
      btnDel.textContent='Apagar';
      btnDel.onclick=()=>{
        if(!confirm('Excluir esta chapa?')) return;
        const all = storage.chapas().filter((_,i)=>i!==idx);
        storage.saveChapas(all);
        renderChapas();
      };

      wrap.appendChild(btnEdit);
      wrap.appendChild(btnDel);
      li.appendChild(wrap);
    }

    list.appendChild(li);
  });

  document.getElementById('formChapa').style.display =
    (roleLocal==='gestor') ? 'flex' : 'none';
}

document.getElementById('formChapa')?.addEventListener('submit', e=>{
  e.preventDefault();
  if(roleLocal!=='gestor') return;
  const nome=document.getElementById('nomeChapa').value.trim();
  const proposta=document.getElementById('propostaChapa').value.trim();
  const integrantes=document.getElementById('integrantesChapa').value.trim();
  const file=document.getElementById('imagemChapa').files[0];
  if(!nome || !proposta) return alert('Nome e proposta obrigat√≥rios.');

  if(file){
    const reader=new FileReader();
    reader.onload=ev=>{
      const all=storage.chapas();
      all.push({nome, proposta, integrantes, imagem:ev.target.result});
      storage.saveChapas(all);
      document.getElementById('formChapa').reset();
      renderChapas();
    };
    reader.readAsDataURL(file);
  } else {
    const all=storage.chapas();
    all.push({nome, proposta, integrantes});
    storage.saveChapas(all);
    document.getElementById('formChapa').reset();
    renderChapas();
  }
});

/* ---------- JOGOS ---------- */
function abrirJogo(url){
  const cont=document.getElementById('gameContainer');
  cont.innerHTML = `<iframe src="${url}" class="w-full h-full border-0"></iframe>`;
}
function renderJogoContainer(){
  document.getElementById('gameContainer').innerHTML =
    `<div class="w-full h-full flex items-center justify-center text-slate-500">Escolha um jogo para iniciar.</div>`;
}

/* ---------- INICIAL ---------- */
renderAvisos();
renderForum();
renderCalendario();
renderChapas();
mostrarTela('avisos');

function abrirEditarPerfil(){
  document.getElementById('modalPerfil').classList.remove('hidden');
  document.getElementById('modalPerfil').classList.add('flex');

  document.getElementById('novoNome').value = nomeUsuario;
  document.getElementById('novoCurso').value = cursoUsuario;
  document.getElementById('novaTurma').value = turmaUsuario;

  const fotoAtual = localStorage.getItem('fotoPerfil');
  if(fotoAtual){
    document.getElementById('previewFoto').src = fotoAtual;
  }
}

function fecharModalPerfil(){
  const modal = document.getElementById('modalPerfil');
  modal.classList.add('hidden');
  modal.classList.remove('flex');
}

function salvarPerfil(){
  const nome = document.getElementById('novoNome').value.trim();
  const curso = document.getElementById('novoCurso').value.trim();
  const turma = document.getElementById('novaTurma').value.trim();
  const fotoInput = document.getElementById('inputFotoPerfil').files[0];

  if(nome) localStorage.setItem('nomeUsuario', nome);
  if(curso) localStorage.setItem('cursoUsuario', curso);
  if(turma) localStorage.setItem('turmaUsuario', turma);

  if(fotoInput){
    const reader = new FileReader();
    reader.onload = function(e){
      localStorage.setItem('fotoPerfil', e.target.result);
      atualizarPerfilTela();
    };
    reader.readAsDataURL(fotoInput);
  } else {
    atualizarPerfilTela();
  }

  fecharModalPerfil();
}

function atualizarPerfilTela(){
  const nome = localStorage.getItem('nomeUsuario') || 'Usu√°rio';
  const curso = localStorage.getItem('cursoUsuario') || 'Inform√°tica';
  const turma = localStorage.getItem('turmaUsuario') || '2¬∫ Ano';
  const foto = localStorage.getItem('fotoPerfil');

  document.getElementById('perfilNomeHeader').textContent = nome;
  document.getElementById('perfilNome').textContent = nome;
  document.getElementById('perfilCurso').textContent = curso;
  document.getElementById('perfilTurma').textContent = turma;

  if(foto){
    document.getElementById('perfilFoto').src = foto;
    document.getElementById('perfilFotoDropdown').src = foto;
  }
}


window.addEventListener('DOMContentLoaded', ()=> {
  document.querySelectorAll('.avatar-opcao').forEach(img=>{
    img.addEventListener('click', ()=>{
      const src = img.getAttribute('src');
      localStorage.setItem('fotoPerfil', src);

      document.getElementById('previewFoto').src = src;
      document.getElementById('perfilFoto').src = src;
      document.getElementById('perfilFotoDropdown').src = src;
    });
  });
});


function abrirModalAvatar() {
  document.getElementById("modalAvatar").classList.remove("hidden");
}

function fecharModalAvatar() {
  document.getElementById("modalAvatar").classList.add("hidden");
}

function selecionarAvatar(src) {
  // salva no localStorage
  localStorage.setItem("fotoPerfil", src);

  // atualiza a foto no header
  const perfilFoto = document.getElementById("perfilFoto");
  const perfilFotoDropdown = document.getElementById("perfilFotoDropdown");

  if (perfilFoto) perfilFoto.src = src;
  if (perfilFotoDropdown) perfilFotoDropdown.src = src;

  fecharModalAvatar();
}

</script>

<!-- MODAL EDITAR PERFIL -->
<div id="modalPerfil" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-white rounded-xl p-6 w-full max-w-md text-slate-900">
    <h2 class="text-lg font-semibold mb-4">Editar Perfil</h2>

    <div class="flex flex-col items-center mb-4">
      <img id="previewFoto" src="https://via.placeholder.com/96"
        class="w-24 h-24 rounded-full object-cover border mb-2">
      <input type="file" id="inputFotoPerfil" accept="image/*" class="text-sm">
    </div>
<p class="text-sm mt-3 mb-2 text-center">Ou escolha um avatar:</p>

<div id="listaAvatares" class="grid grid-cols-5 gap-3 mb-4 justify-items-center">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296998/Gemini_Generated_Image_suuw93suuw93suuw_yesnse.png" class="avatar-opcao">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296884/Gemini_Generated_Image_4ha114ha114ha114_ddr8lb.png" class="avatar-opcao">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296788/Gemini_Generated_Image_1th42t1th42t1th4_lrv7mp.png" class="avatar-opcao">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296504/Gemini_Generated_Image_d3y60bd3y60bd3y6_niuk9l.png" class="avatar-opcao">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296414/Gemini_Generated_Image_37126q37126q3712_b8shn6.png" class="avatar-opcao">
  <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296269/Gemini_Generated_Image_hui2lbhui2lbhui2_tmxp33.png" class="avatar-opcao">
  <img src="https://i.pravatar.cc/100?img=7" class="avatar-opcao">
  <img src="https://i.pravatar.cc/100?img=8" class="avatar-opcao">
  <img src="https://i.pravatar.cc/100?img=9" class="avatar-opcao">
  <img src="https://i.pravatar.cc/100?img=10" class="avatar-opcao">
</div>

    <div class="space-y-3">
      <input id="novoNome" type="text" placeholder="Nome"
        class="w-full border rounded px-3 py-2">
      <input id="novoCurso" type="text" placeholder="Curso"
        class="w-full border rounded px-3 py-2">
      <input id="novaTurma" type="text" placeholder="Turma"
        class="w-full border rounded px-3 py-2">
    </div>

    <div class="flex gap-3 mt-5">
      <button onclick="salvarPerfil()"
        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">
        Salvar
      </button>
      <button onclick="fecharModalPerfil()"
        class="flex-1 bg-slate-300 hover:bg-slate-400 py-2 rounded">
        Cancelar
      </button>
    </div>
  </div>
</div>

<!-- MODAL DE ESCOLHER FOTO DE PERFIL -->
<div id="modalAvatar" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white p-6 rounded-xl w-[360px] shadow-xl">

    <h3 class="text-lg font-semibold mb-3 text-slate-700">Escolha seu Avatar</h3>

    <div class="grid grid-cols-3 gap-3">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296998/Gemini_Generated_Image_suuw93suuw93suuw_yesnse.png" class="avatar-opcao onclick="selecionarAvatar(this.src)">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296884/Gemini_Generated_Image_4ha114ha114ha114_ddr8lb.png" class="avatar-opcao" onclick="selecionarAvatar(this.src)">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296788/Gemini_Generated_Image_1th42t1th42t1th4_lrv7mp.png" class="avatar-opcao" onclick="selecionarAvatar(this.src)">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296504/Gemini_Generated_Image_d3y60bd3y60bd3y6_niuk9l.png" class="avatar-opcao" onclick="selecionarAvatar(this.src)">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296414/Gemini_Generated_Image_37126q37126q3712_b8shn6.png" class="avatar-opcao" onclick="selecionarAvatar(this.src)">
      <img src="https://res.cloudinary.com/dm9eurdck/image/upload/v1764296269/Gemini_Generated_Image_hui2lbhui2lbhui2_tmxp33.png" class="avatar-opcao" onclick="selecionarAvatar(this.src)">
    </div>

    <div class="mt-4 text-right">
      <button class="px-4 py-2 bg-slate-300 rounded" onclick="fecharModalAvatar()">Fechar</button>
    </div>

  </div>
</div>

<script>

  const tipo = localStorage.getItem("role"); // CORRETO: voc√™ usa "role"

  const topo = document.getElementById("tipoUsuarioTopo");

  if (topo) {
    if (tipo === "gestor") {
      topo.textContent = "Gestor";
      topo.style.background = "#b91c1c"; // vermelho
    } 
    else if (tipo === "aluno") {
      topo.textContent = "Aluno";
      topo.style.background = "#059669"; // verde
    } 
    else {
      topo.textContent = "Desconectado";
      topo.style.background = "#6b7280"; // cinza
    }
  }
</script>

</script>

</body>
</html>
